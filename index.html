document.addEventListener("DOMContentLoaded", () => {
  const poemBox = document.getElementById("poemBox");
  const chime = document.getElementById("chimeSound");

  const userLineInput = document.getElementById("userLine");
  const customRhymeInput = document.getElementById("customRhyme");

  document.getElementById("btnMakePoem").addEventListener("click", () => {
    generatePoem(false);
  });

  document.getElementById("btnRhymingPoem").addEventListener("click", () => {
    generatePoem(true);
  });

  document.getElementById("btnCopyPoem").addEventListener("click", () => {
    copyPoem();
  });

  const additionalLines = [
    "And that is how the tale begins.",
    "The world grew quiet just to hear.",
    "A gentle breeze carried the dream.",
    "And colors danced through skies so clear.",
    "Its echo sang from hill to hill.",
    "And magic lingered in the air.",
    "A whisper rode the curling breeze.",
    "And sparkles shimmered everywhere."
  ];

  const rhymeGroups = [ /* ... same as your existing array ... */ ];

  function generatePoem(useRhyme) {
    const userLine = userLineInput.value.trim();
    const rhyme = customRhymeInput.value.trim().toLowerCase();

    let poem = "";

    if (userLine) {
      poem += userLine + "\n";
    }

    if (useRhyme && rhyme) {
      const group = rhymeGroups.find(g => g.rhymes.includes(rhyme) || g.base === rhyme);
      if (group) {
        const line = group.lines[0];
        const rhymedLine = group.lines[1].replace("{rhyme}", rhyme);
        poem += line + "\n" + rhymedLine + "\n";
      } else {
        poem += getRandomLine() + "\n" + getRandomLine() + "\n";
      }
    } else {
      poem += getRandomLine() + "\n" + getRandomLine() + "\n";
    }

    updatePoem(poem);
  }

  function getRandomLine() {
    return additionalLines[Math.floor(Math.random() * additionalLines.length)];
  }

  function updatePoem(text) {
    poemBox.textContent = text;
    poemBox.classList.add("bounce");
    chime.play();

    setTimeout(() => {
      poemBox.classList.remove("bounce");
    }, 600);
  }

  function copyPoem() {
    const text = poemBox.textContent;
    navigator.clipboard.writeText(text).then(() => {
      alert("Poem copied to clipboard!");
    });
  }
});
