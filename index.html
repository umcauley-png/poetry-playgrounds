<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>St Catherine's Poetry Playground</title>
  <style>
    body {
      font-family: 'Avenir Next', 'Segoe UI', 'Helvetica Neue', sans-serif;
      background: url('https://raw.githubusercontent.com/umcauley-png/poetry-playgrounds/refs/heads/main/a%20playground%20that%20i%20can%20use%20as%20a%20background.jpg') no-repeat center center fixed;
      background-size: cover;
      color: #6A5ACD;
      text-align: center;
      padding: 40px 20px;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    h1 {
      color: #f582ae;
      background-color: rgba(255, 255, 255, 0.8);
      display: inline-block;
      padding: 10px 20px;
      border-radius: 12px;
      margin-bottom: 0.2em;
    }

    p#subtitle {
      margin-top: 0;
      font-weight: 600;
      margin-bottom: 20px;
      color: #444;
    }

    .poem-box {
      margin-top: 30px;
      font-size: 1.6rem;
      background-color: #fffefc;
      padding: 30px;
      border-radius: 15px;
      min-height: 160px;
      width: 380px;
      max-width: 95vw;
      color: #172c66;
      box-shadow: 0 0 15px rgba(0,0,0,0.25);
      white-space: pre-line;
      text-align: center;
      position: relative;
      box-sizing: border-box;
      border: 12px solid transparent;
    }

    .poem-line {
      opacity: 0;
      transform: translateY(10px);
      animation: fadeInUp 0.8s forwards;
      word-wrap: break-word;
    }

    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(10px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    button {
      background-color: #ffb703;
      border: none;
      padding: 15px 30px;
      font-size: 1.2rem;
      margin: 15px 8px;
      border-radius: 10px;
      cursor: pointer;
      transition: background 0.3s ease;
      font-family: inherit;
    }

    button:hover { background-color: #fb8500; }

    #copyButton { background-color: #4caf50; }
    #copyButton:hover { background-color: #3a8a38; }

    #saveButton { background-color: #219ebc; color: white; }
    #saveButton:hover { background-color: #126782; }
  </style>
</head>
<body>
  <h1>St Catherine's Poetry Playground</h1>
  <p id="subtitle">Click the button to create your own poem!</p>

  <div class="poem-box" id="poemBox">
    Your poem will appear here...
  </div>

  <div>
    <button onclick="generatePoem()">Make a Poem</button>
    <button id="copyButton" onclick="copyPoem()">Copy Poem</button>
    <button id="saveButton" onclick="savePoem()">Save as Image</button>
  </div>

  <audio id="chimeSound" src="magic_chime.mp3" preload="auto"></audio>

  <!-- html2canvas for saving poems -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <script>
    const wordBanks = {
      who: [
        "A shimmering fox", "The restless river", "A golden eagle", "The playful otter", "A silver wolf",
        "The gentle giant whale", "A curious cat", "The soaring falcon", "A striped tiger", "The glowing firefly"
      ],
      action: [
        "glides gracefully", "dances wildly", "bursts with laughter", "soars boldly", "tiptoes silently",
        "hums a secret song", "stomps playfully", "twirls in delight", "dreams quietly", "spins in wonder"
      ],
      where: [
        "beneath the endless sky", "in the golden savanna", "through the jungle canopy", "by the coral reef",
        "under the frosted moon", "beside the quiet stream", "across the rolling hills", "within the secret garden",
        "along the desert sands", "underneath the tall pines"
      ]
    };

    const additionalLines = [
      "Where dreams take flight", "In a world of wonder", "With magic in the air", "As the night softly falls",
      "Beneath the sparkling sky", "Until the morning wakes", "Where silence hums with light", "As rivers sing their song",
      "While shadows gently fade", "Where laughter paints the air", "Until the stars grow tired", "As dawn begins to glow",
      "When whispers meet the wind", "Where colors start to bloom",
      "As the meadow drifts to sleep", "Where oceans guard their secrets", "Until the golden sun returns",
      "As mountains whisper low", "Where the horizon melts away", "As fireflies light the dark", "Where time forgets to move"
    ];

    // Pool of frame images
    const frames = [
      "https://i.imgur.com/BLFvZfY.png",
      "https://i.imgur.com/4Ih7Bbn.png",
      "https://i.imgur.com/dnFXvbX.png",
      "https://i.imgur.com/MxIjCOy.png"
    ];

    function getRandom(arr){ return arr[Math.floor(Math.random()*arr.length)]; }

    function applyAlliteration(line) {
      const words = line.split(" ");
      if (words.length > 2) {
        const letter = words[1][0].toLowerCase();
        return words.map((w,i)=> (i>0 && w[0].toLowerCase()===letter? w.toUpperCase(): w)).join(" ");
      }
      return line;
    }

    function generateRandomPoem(){
      let lines = [];
      const line1 = getRandom(wordBanks.who);
      const line2 = getRandom(wordBanks.action);
      const line3 = getRandom(wordBanks.where);
      const line4 = getRandom(additionalLines);

      lines = [line1, line2, line3, line4];

      // Rare alliteration
      if (Math.random() < 0.16) {
        const idx = Math.floor(Math.random() * lines.length);
        lines[idx] = applyAlliteration(lines[idx]);
      }

      // Capitalize first line
      lines[0] = lines[0].charAt(0).toUpperCase() + lines[0].slice(1);
      return lines;
    }

    function generatePoem(){
      const poemBox = document.getElementById('poemBox');
      poemBox.innerHTML = "";
      const lines = generateRandomPoem();
      lines.forEach((line, i) => {
        const div = document.createElement("div");
        div.className = "poem-line";
        div.style.animationDelay = `${i*0.8}s`;
        div.textContent = line;
        poemBox.appendChild(div);
      });

      // ðŸŽ¨ Apply a random frame
      const frame = getRandom(frames);
      poemBox.style.borderImage = `url('${frame}') 30 round`;

      const sound = document.getElementById("chimeSound");
      if(sound){ sound.currentTime=0; sound.play(); }
    }

    function copyPoem(){
      const text = [...document.querySelectorAll(".poem-line")].map(el=>el.textContent).join("\n");
      navigator.clipboard.writeText(text).then(()=>alert('Poem copied!'));
    }

    function savePoem(){
      const poemBox = document.getElementById("poemBox");
      html2canvas(poemBox, {backgroundColor: "#fff"}).then(canvas=>{
        const link = document.createElement("a");
        link.download = "poem.png";
        link.href = canvas.toDataURL("image/png");
        link.click();
      });
    }
  </script>
</body>
</html>

